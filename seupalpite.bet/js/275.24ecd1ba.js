"use strict";(self["webpackChunkjb_web_app"]=self["webpackChunkjb_web_app"]||[]).push([[275],{76275:function(t,e,a){a.r(e),a.d(e,{default:function(){return Lt}});var i=a(73396),n=a(87139);const s=t=>((0,i.dD)("data-v-0866f0f2"),t=t(),(0,i.Cn)(),t),l={class:"authenticate"},o=s((()=>(0,i._)("h3",null,"Autenticar bilhete",-1))),c={class:"search"},r={key:0},d={key:1,class:"authentication-proof"},u={class:"btn-ticket"},p={class:"print"},h=s((()=>(0,i._)("i",{class:"fas fa-print"},null,-1))),_=s((()=>(0,i._)("i",{class:"fas fa-share-alt"},null,-1))),m=s((()=>(0,i._)("div",null,[(0,i._)("span",null,"COMPROVANTE DE PAGAMENTO")],-1))),w={class:"row"},k=s((()=>(0,i._)("span",null,"Ponto",-1))),f={class:"row"},g=s((()=>(0,i._)("span",null,"Data Criação",-1))),v={class:"row"},z=s((()=>(0,i._)("span",null,"Data Autenticação",-1))),C={class:"row"},y=s((()=>(0,i._)("span",null,"Bilhete",-1))),b={class:"row"},T=s((()=>(0,i._)("span",null,"Cód.",-1))),D={class:"row"},A=s((()=>(0,i._)("span",null,"Valor pago",-1))),x=s((()=>(0,i._)("legend",null,[(0,i._)("i",{class:"pi pi -chart-bar"}),(0,i.Uk)("   ")],-1))),$={class:"row"},P=s((()=>(0,i._)("span",null,"Extração",-1))),B={class:"row"},F=s((()=>(0,i._)("span",null,"Acertos",-1))),O={style:{color:"green"}},R={class:"row"},M=s((()=>(0,i._)("span",null,"Erros",-1))),S={style:{color:"red"}},V={class:"row"},E=s((()=>(0,i._)("span",null,"Valor a receber",-1))),N={class:"row"},W={class:"ticket-container"},j={class:"ticket-header"},q={class:"row"},J=s((()=>(0,i._)("span",null,"Ponto",-1))),Q={class:"row"},I=s((()=>(0,i._)("span",null,"Bilhete",-1))),U={class:"row"},H=s((()=>(0,i._)("span",null,"Código",-1))),L={class:"row"},Z=s((()=>(0,i._)("span",null,"Emissão",-1))),K={class:"row"},Y=s((()=>(0,i._)("span",null,"Sorteio",-1))),G={class:"ticket-content"},X={class:"ticket-footer"},tt=s((()=>(0,i._)("legend",null,[(0,i._)("i",{class:"pi pi-chart-bar"}),(0,i.Uk)("   ")],-1))),et={class:"row"},at=s((()=>(0,i._)("span",null,"Concurso",-1))),it={class:"row"},nt=s((()=>(0,i._)("span",null,"Valor a receber",-1))),st={class:"row"},lt={class:"ticket-container"},ot={class:"ticket-header"},ct={class:"row"},rt=s((()=>(0,i._)("span",null,"Ponto",-1))),dt={class:"row"},ut=s((()=>(0,i._)("span",null,"Bilhete",-1))),pt={class:"row"},ht=s((()=>(0,i._)("span",null,"Código",-1))),_t={class:"row"},mt=s((()=>(0,i._)("span",null,"Emissão",-1))),wt={key:0,class:"ticket-content"},kt={class:"ticket-game"},ft={class:"ticket-footer"},gt=s((()=>(0,i._)("legend",null,[(0,i._)("i",{class:"pi pi-chart-bar"}),(0,i.Uk)("   ")],-1))),vt={class:"row"},zt=s((()=>(0,i._)("span",null,"Rodada",-1))),Ct={class:"row"},yt=s((()=>(0,i._)("span",null,"Valor a receber",-1))),bt={class:"row"},Tt={class:"ticket-container"},Dt={class:"ticket-header"},At={class:"row"},xt=s((()=>(0,i._)("span",null,"Ponto",-1))),$t={class:"row"},Pt=s((()=>(0,i._)("span",null,"Bilhete",-1))),Bt={class:"row"},Ft=s((()=>(0,i._)("span",null,"Código",-1))),Ot={class:"row"},Rt=s((()=>(0,i._)("span",null,"Emissão",-1))),Mt={class:"ticket-content"},St={class:"ticket-game"},Vt={class:"ticket-footer"};function Et(t,e,a,s,Et,Nt){const Wt=(0,i.up)("Dropdown"),jt=(0,i.up)("InputText"),qt=(0,i.up)("Button"),Jt=(0,i.up)("qrcode-stream"),Qt=(0,i.up)("Divider");return(0,i.wg)(),(0,i.iD)("div",l,[o,(0,i._)("div",c,[(0,i.Wm)(Wt,{onChange:e[0]||(e[0]=t=>Et.tickets=[]),modelValue:Et.type,"onUpdate:modelValue":e[1]||(e[1]=t=>Et.type=t),options:Et.types,placeholder:"Tipo"},null,8,["modelValue","options"]),(0,i.Wm)(jt,{modelValue:Et.code,"onUpdate:modelValue":e[2]||(e[2]=t=>Et.code=t)},null,8,["modelValue"]),(0,i.Wm)(qt,{onClick:Nt.handleFindTicket,class:"btn-submit",label:"Buscar bilhete",loading:Et.loading},null,8,["onClick","loading"]),(0,i.Wm)(qt,{onClick:Nt.toggleshowQrcodeReader,class:"btn-submit",label:"Ler QRCODE"},null,8,["onClick"])]),Et.showQrcodeReader?((0,i.wg)(),(0,i.iD)("div",r,[(0,i._)("p",null,[(0,i._)("b",null,(0,n.zw)(Et.error),1)]),(0,i.Wm)(Jt,{camera:Et.camera,onDecode:Nt.onDecode,onInit:Nt.onInit},null,8,["camera","onDecode","onInit"])])):(0,i.kq)("",!0),Et.showproofOfAuthentication&&Et.ticket&&Et.ticket.authenticated_at?((0,i.wg)(),(0,i.iD)("fieldset",d,[(0,i._)("legend",u,[(0,i._)("div",p,[(0,i.Wm)(qt,{elevation:"2",onClick:Nt.handleButtonPrint,class:"print-btn"},{default:(0,i.w5)((()=>[h])),_:1},8,["onClick"]),(0,i.Wm)(qt,{elevation:"2",onClick:Nt.handleButtonShare,class:"print-btn"},{default:(0,i.w5)((()=>[_])),_:1},8,["onClick"])])]),m,(0,i.Wm)(Qt),(0,i._)("div",null,[(0,i._)("p",w,[k,(0,i._)("span",null,(0,n.zw)(Et.ticket.point_name),1)]),(0,i._)("p",f,[g,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(Et.ticket.created_at)),1)]),(0,i._)("p",v,[z,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(Et.ticket.authenticated_at)),1)]),(0,i._)("p",C,[y,(0,i._)("span",null,(0,n.zw)(Et.ticket.id),1)]),(0,i._)("p",b,[T,(0,i._)("span",null,(0,n.zw)(Et.ticket.code),1)]),(0,i._)("p",D,[A,(0,i._)("span",null,(0,n.zw)(this.formatCurrency(Nt.calcularTotalRecebimento(Et.ticket))),1)])])])):(0,i.kq)("",!0),"JB"==Et.type?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:2},(0,i.Ko)(Et.tickets,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.id},[(0,i._)("fieldset",null,[x,(0,i._)("p",$,[P,(0,i._)("span",null,(0,n.zw)(t.games[0].extraction_name),1)]),(0,i._)("p",B,[F,(0,i._)("span",O,(0,n.zw)(t.games_won),1)]),(0,i._)("p",R,[M,(0,i._)("span",S,(0,n.zw)(t.games_lost),1)]),(0,i._)("p",V,[E,(0,i._)("span",null,(0,n.zw)(this.formatCurrency(Nt.calcularTotalRecebimento(t))),1)]),(0,i._)("p",N,[(0,i._)("span",null,(0,n.zw)(t.paid?"Autenticado em":"Não autenticado"),1),(0,i._)("span",null,(0,n.zw)(t.paid?this.formatDateFull(t.authenticated_at):""),1)])]),(0,i._)("div",W,[(0,i._)("div",j,[(0,i._)("div",q,[J,(0,i._)("span",null,(0,n.zw)(t.point_name),1)]),(0,i._)("div",Q,[I,(0,i._)("span",null,(0,n.zw)(t.id),1)]),(0,i._)("div",U,[H,(0,i._)("span",null,(0,n.zw)(t.code),1)]),(0,i._)("div",L,[Z,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(t.created_at)),1)]),(0,i._)("div",K,[Y,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(t.extraction_date)),1)])]),(0,i.Wm)(Qt),(0,i._)("div",G,[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(t.games,((t,e)=>((0,i.wg)(),(0,i.iD)("div",{class:"ticket-game",key:e},[(0,i._)("span",null,"Modalidade: "+(0,n.zw)(t.modality_name),1),(0,i._)("span",null,"Posição: "+(0,n.zw)(t.award_name),1),(0,i._)("span",null,"Palpites: "+(0,n.zw)(JSON.parse(t.selected_numbers).join(", ")),1),(0,i._)("span",null,"Apostado: "+(0,n.zw)(this.formatCurrency(t.value)),1),(0,i._)("div",null,[(0,i._)("span",null,(0,n.zw)("win"==t.status?"Ganhou: "+this.formatCurrency(t.expected_value):"Perdeu"),1),(0,i._)("i",{class:(0,n.C_)("win"==t.status?"fas fa-check":"fas fa-times")},null,2)]),(0,i.Wm)(Qt)])))),128))]),(0,i._)("div",X,[(0,i._)("span",null,"Total apostado: "+(0,n.zw)(this.formatCurrency(t.total_value)),1),1==t.validated&&0==t.paid&&t.games_won>0?((0,i.wg)(),(0,i.j4)(qt,{key:0,onClick:e=>Nt.handleAuthenticateTicket(t),class:"btn-submit",label:"Autenticar",loading:Et.loading},null,8,["onClick","loading"])):(0,i.kq)("",!0)])])])))),128)):(0,i.kq)("",!0),"Caixa"==Et.type?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:3},(0,i.Ko)(Et.tickets,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.id},[(0,i._)("fieldset",null,[tt,(0,i._)("p",et,[at,(0,i._)("span",null,(0,n.zw)(t.contest_name),1)]),(0,i._)("p",it,[nt,(0,i._)("span",null,(0,n.zw)(this.formatCurrency(parseFloat(t.expected_value))),1)]),(0,i._)("p",st,[(0,i._)("span",null,(0,n.zw)(t.paid?"Autenticado em":"Não autenticado"),1),(0,i._)("span",null,(0,n.zw)(t.paid?this.formatDateFull(t.authenticated_at):""),1)])]),(0,i._)("div",lt,[(0,i._)("div",ot,[(0,i._)("div",ct,[rt,(0,i._)("span",null,(0,n.zw)(t.point_name),1)]),(0,i._)("div",dt,[ut,(0,i._)("span",null,(0,n.zw)(t.id),1)]),(0,i._)("div",pt,[ht,(0,i._)("span",null,(0,n.zw)(t.code),1)]),(0,i._)("div",_t,[mt,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(t.created_at)),1)])]),(0,i.Wm)(Qt),t.contest_id?((0,i.wg)(),(0,i.iD)("div",wt,[(0,i._)("div",kt,[(0,i._)("span",null,"Palpites: "+(0,n.zw)(JSON.parse(t.selected_numbers).join(", ")),1),(0,i._)("span",null,"Apostado: "+(0,n.zw)(this.formatCurrency(parseFloat(t.total_value))),1),(0,i.Wm)(Qt)])])):(0,i.kq)("",!0),(0,i._)("div",ft,[(0,i._)("span",null,"Total apostado: "+(0,n.zw)(this.formatCurrency(parseFloat(t.total_value))),1),1==t.validated&&0==t.paid&&t.expected_value>0?((0,i.wg)(),(0,i.j4)(qt,{key:0,onClick:e=>Nt.handleAuthenticateTicket(t),class:"btn-submit",label:"Autenticar",loading:Et.loading},null,8,["onClick","loading"])):(0,i.kq)("",!0)])])])))),128)):(0,i.kq)("",!0),"Bolão de dezenas"==Et.type?((0,i.wg)(!0),(0,i.iD)(i.HY,{key:4},(0,i.Ko)(Et.tickets,(t=>((0,i.wg)(),(0,i.iD)("div",{key:t.id},[(0,i._)("fieldset",null,[gt,(0,i._)("p",vt,[zt,(0,i._)("span",null,(0,n.zw)(t.round_id),1)]),(0,i._)("p",Ct,[yt,(0,i._)("span",null,(0,n.zw)(this.formatCurrency(parseFloat(t.expected_value))),1)]),(0,i._)("p",bt,[(0,i._)("span",null,(0,n.zw)(t.paid?"Autenticado em":"Não autenticado"),1),(0,i._)("span",null,(0,n.zw)(t.paid?this.formatDateFull(t.authenticated_at):""),1)])]),(0,i._)("div",Tt,[(0,i._)("div",Dt,[(0,i._)("div",At,[xt,(0,i._)("span",null,(0,n.zw)(t.point_name),1)]),(0,i._)("div",$t,[Pt,(0,i._)("span",null,(0,n.zw)(t.id),1)]),(0,i._)("div",Bt,[Ft,(0,i._)("span",null,(0,n.zw)(t.code),1)]),(0,i._)("div",Ot,[Rt,(0,i._)("span",null,(0,n.zw)(this.formatDateFull(t.created_at)),1)])]),(0,i.Wm)(Qt),(0,i._)("div",Mt,[(0,i._)("div",St,[(0,i._)("span",null,"Palpites: "+(0,n.zw)(JSON.parse(t.selected_numbers).join(", ")),1),(0,i._)("span",null,"Apostado: "+(0,n.zw)(this.formatCurrency(parseFloat(t.total_value))),1),(0,i._)("span",null,"Rodada: "+(0,n.zw)(t.round_id),1),(0,i.Wm)(Qt)])]),(0,i._)("div",Vt,[(0,i._)("span",null,"Total apostado: "+(0,n.zw)(this.formatCurrency(parseFloat(t.total_value))),1),1==t.validated&&0==t.paid&&t.expected_value>0?((0,i.wg)(),(0,i.j4)(qt,{key:0,onClick:e=>Nt.handleAuthenticateTicket(t),class:"btn-submit",label:"Autenticar",loading:Et.loading},null,8,["onClick","loading"])):(0,i.kq)("",!0)])])])))),128)):(0,i.kq)("",!0)])}a(82801);var Nt=a(31826),Wt=a(76709),jt=a(81937),qt=a(9356),Jt=a.n(qt),Qt=a(15517),It={components:{Button:Nt.Z,Divider:jt.Z,InputText:Wt.Z,QrcodeVue:Jt(),Dropdown:Qt.Z},data(){return{loading:!1,code:null,type:"JB",ticket:null,total:0,types:["JB","Caixa","Bolão de dezenas"],camera:"auto",error:null,showQrcodeReader:!1,showproofOfAuthentication:!1,printMethod:null,paperSize:null,fontSize:null,value:"https://example.com",size:150,tickets:[]}},created(){this.paperSize=this.$store.getters.getPaperSize,this.fontSize=this.$store.getters.getFontSize,this.printMethod=this.$store.getters.getPrintMethod},methods:{toggleshowQrcodeReader(){this.showQrcodeReader?this.turnCameraOff():this.turnCameraOn()},turnCameraOn(){this.camera="auto",this.showQrcodeReader=!0},turnCameraOff(){this.camera="off",this.showQrcodeReader=!1},async onDecode(t){var e=JSON.parse(t);for(var a of(this.tickets=[],e))this.code=a.code,this.findTicket();this.turnCameraOff()},onInit(t){t.catch(console.error).then(this.resetValidationState)},handleFindTicket(){this.tickets=[],this.findTicket()},findTicket(){this.loading=!0;let t="";"JB"==this.type&&(t=`tickets/${this.code}`),"Caixa"==this.type&&(t=`caixa_tickets/${this.code}`),"Bolão de dezenas"==this.type&&(t=`round_tickets/${this.code}`),this.$api.get(t,{headers:{Authorization:this.accessToken()}}).then((t=>{this.loading=!1,this.ticket=t.data,this.tickets.push(this.ticket)})).catch((()=>{this.loading=!1,this.$toast.add({severity:"error",summary:"Erro",detail:"Não foi possível encontrar o bilhete",life:3e3})}))},handleAuthenticateTicket(t){this.loading=!0;let e="";"JB"==this.type&&(e="tickets/rescue"),"Caixa"==this.type&&(e="caixa_tickets/rescue"),"Bolão de dezenas"==this.type&&(e="round_tickets/rescue");let a=t.id;this.$api.post(e,{id:a},{headers:{Authorization:this.accessToken()}}).then((t=>{this.loading=!1,this.ticket=t.data,this.showproofOfAuthentication=!0,this.$toast.add({severity:"success",summary:"Sucesso",detail:"Bilhete autenticado com sucesso!",life:3e3})})).catch((t=>{this.loading=!1,this.$toast.add({severity:"error",summary:"Erro",detail:t.response.data.error,life:3e3})}))},handleButtonPrint(){if("Tipo 1"==this.printMethod){let t=this.drawAuthenticationProof();document.location="rawbt:"+t.toDataURL()}if("Tipo 2"==this.printMethod){let t=this.drawAuthenticationProof();t.toBlob((e=>{this.$api.post("/images/stores3",{attachment:e},{headers:{"Content-Type":"multipart/form-data",Authorization:this.accessToken()}}).then((e=>{const a=btoa(e.data.url+`&width=${t.width}`);document.location=`buprinter://print/${a}`})).catch((t=>{console.log(t)}))}))}if("Tipo 3"==this.printMethod){let t=this.generateHtmlAuthenticationProof();document.location.href=t}if("Tipo 4"==this.printMethod){let t=this.drawAuthenticationProof();this.$api.post("/images",{base64:t.toDataURL(),height:t.height,width:t.width},{headers:{Authorization:this.accessToken()}}).then((t=>{document.location=`buprinter://print/${t.data.image.id}`})).catch((t=>{console.log(t)}))}if("Tipo 5"==this.printMethod){let t=this.drawAuthenticationProof();t.toBlob((t=>{this.$api.post("/images/stores3",{attachment:t},{headers:{"Content-Type":"multipart/form-data",Authorization:this.accessToken()}}).then((t=>{document.location=`imageprinterapp://${t.data.url}&width=${this.paperSize}`})).catch((t=>{console.log(t)}))}))}},handleButtonShare(){let t=`\n            ==============================\n                COMPROVANTE DE PAGAMENTO\n            ==============================\n            Ponto: ${this.ticket.point_name}\n            Data Criação: ${this.formatDateFull(this.ticket.created_at)}\n            Data Autenticação: ${this.formatDateFull(this.ticket.authenticated_at)}\n            Ticket: ${this.ticket.id}\n            Cód.: ${this.ticket.code}\n            Valor pago: ${this.formatCurrency(this.calcularTotalRecebimento(this.ticket))}\n            `;navigator.share({title:"Comprovante de pagamento",text:t})},drawAuthenticationProof(){var t=document.createElement("canvas");t.width="80MM"==this.paperSize?576:376,t.height=1e3;var e=t.getContext("2d");let a=0,i=10;return i=this.drawLine(e,a,i),i=this.drawTitle("COMPROVANTE",e,t.width/2,i),i=this.drawLine(e,a,i),i=this.drawText("Ponto: "+this.ticket.point_name,e,a,i),i=this.drawText("Data criação: "+this.formatDateFull(this.ticket.created_at),e,a,i),i=this.drawText("Data autenticação: "+this.formatDateFull(this.ticket.authenticated_at),e,a,i),i=this.drawText(`Ticket: ${this.ticket.id}`,e,a,i),i=this.drawText(`Cód.: ${this.ticket.code}`,e,a,i),i=this.drawText(`Valor pago: ${this.formatCurrency(this.calcularTotalRecebimento(this.ticket))}`,e,a,i),this.resizeCanvas(t,e,t.width,i),t},generateHtmlAuthenticationProof(){let t="print://escpos.org/escpos/bt/print?srcTp=uri&srcObj=html&src='data:text/html,";return t+=`<div style="width: ${"58MM"==this.paperSize?"219.21px":"302.36px"}; margin: 0; padding: 0; font-size: ${.7*this.fontSize}">`,t+='  \n            <div style="display: flex; padding-top: 5px; justify-content: center; border-bottom: solid black 1px; border-top: solid black 1px">\n                <span>COMPROVANTE</span>\n            </div>\n            ',t+=`\n            <div style="display: flex; flex-direction: column;">\n                <span>${"Ponto: "+this.ticket.point_name}</span>\n                <span>${"Data: "+this.formatDateFull(this.ticket.authenticated_at)}</span>\n                <span>${"Ticket: "+this.ticket.id}</span>\n                <span>${"Cód.: "+this.ticket.code}</span>\n                <span>${"Valor pago: "+this.formatCurrency(this.calcularTotalRecebimento(this.ticket))}</span>\n            </div>\n            `,t+="</div>",t},calcularTotalRecebimento(t){let e=0;if("JB"==this.type){const a=t.games.filter((t=>"win"==t.status));e=a.reduce(((t,e)=>t+parseFloat(e.expected_value)),0)}else e=t.expected_value;return e}}},Ut=a(40089);const Ht=(0,Ut.Z)(It,[["render",Et],["__scopeId","data-v-0866f0f2"]]);var Lt=Ht}}]);
//# sourceMappingURL=275.24ecd1ba.js.map